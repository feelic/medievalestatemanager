<canvas id="voronoiCanvas" width="600" height="600" style="border:1px solid gray;"></canvas>
<script>
// THESE ARE THE VALUES FOR ONE OF THE CELLS THAT DO NOT SHOW ON THE MAP : THIS REQUIRES FURTHER INQUIRY
function Test () {
	this.samplePath = [{"x":3.5067114093959724,"y":479.6476510067114},{"x":3.5067114093959724,"y":479.6476510067114},{"x":5,"y":481},{"x":4,"y":480},{"x":3,"y":480},{"x":2,"y":480},{"x":2,"y":480},{"x":2,"y":480},{"x":0,"y":479},{"x":4.440892098500626e-16,"y":478.6979166666667}]

	this.halfedges = [
		{
			"site": {
				"x": 15,
				"y": 457,
				"voronoiId": 548
			},
			"edge": {
				"lSite": {
					"x": 2,
					"y": 505,
					"voronoiId": 607
				},
				"rSite": {
					"x": 15,
					"y": 457,
					"voronoiId": 548
				},
				"vb": {
					"x": 4.440892098500626e-16,
					"y": 478.6979166666667
				},
				"va": {
					"x": 3.5067114093959724,
					"y": 479.6476510067114
				},
				"path": [
					{
						"x": 3.5067114093959724,
						"y": 479.6476510067114
					},
					{
						"x": 5,
						"y": 481
					},
					{
						"x": 4,
						"y": 480
					},
					{
						"x": 3,
						"y": 480
					},
					{
						"x": 2,
						"y": 480
					},
					{
						"x": 2,
						"y": 480
					},
					{
						"x": 2,
						"y": 480
					},
					{
						"x": 0,
						"y": 479
					},
					{
						"x": 4.440892098500626e-16,
						"y": 478.6979166666667
					}
				]
			},
			"angle": 1.8352847093441291
		},
		{
			"site": {
				"x": 15,
				"y": 457,
				"voronoiId": 548
			},
			"edge": {
				"lSite": {
					"x": 27,
					"y": 470,
					"voronoiId": 561
				},
				"rSite": {
					"x": 15,
					"y": 457,
					"voronoiId": 548
				},
				"vb": {
					"x": 3.5067114093959724,
					"y": 479.6476510067114
				},
				"va": {
					"x": 12.23913043478261,
					"y": 471.5869565217391
				},
				"path": [
					{
						"x": 12.23913043478261,
						"y": 471.5869565217391
					},
					{
						"x": 13,
						"y": 472
					},
					{
						"x": 11,
						"y": 475
					},
					{
						"x": 10,
						"y": 475
					},
					{
						"x": 6,
						"y": 474
					},
					{
						"x": 6,
						"y": 475
					},
					{
						"x": 7,
						"y": 476
					},
					{
						"x": 6,
						"y": 476
					},
					{
						"x": 3.5067114093959724,
						"y": 479.6476510067114
					}
				]
			},
			"angle": 0.8253768505207384
		},
		{
			"site": {
				"x": 15,
				"y": 457,
				"voronoiId": 548
			},
			"edge": {
				"lSite": {
					"x": 25,
					"y": 464,
					"voronoiId": 556
				},
				"rSite": {
					"x": 15,
					"y": 457,
					"voronoiId": 548
				},
				"vb": {
					"x": 12.23913043478261,
					"y": 471.5869565217391
				},
				"va": {
					"x": 25.223076923076924,
					"y": 453.03846153846155
				},
				"path": [
					{
						"x": 25.223076923076924,
						"y": 453.03846153846155
					},
					{
						"x": 23,
						"y": 459
					},
					{
						"x": 16,
						"y": 465
					},
					{
						"x": 17,
						"y": 470
					},
					{
						"x": 13,
						"y": 471
					},
					{
						"x": 14,
						"y": 471
					},
					{
						"x": 14,
						"y": 471
					},
					{
						"x": 12,
						"y": 471
					},
					{
						"x": 12.23913043478261,
						"y": 471.5869565217391
					}
				]
			},
			"angle": 0.6107259643892086
		},
		{
			"site": {
				"x": 15,
				"y": 457,
				"voronoiId": 548
			},
			"edge": {
				"lSite": {
					"x": 35,
					"y": 458,
					"voronoiId": 549
				},
				"rSite": {
					"x": 15,
					"y": 457,
					"voronoiId": 548
				},
				"vb": {
					"x": 25.223076923076924,
					"y": 453.03846153846155
				},
				"va": {
					"x": 25.81769722814499,
					"y": 441.1460554371002
				},
				"path": [
					{
						"x": 25.81769722814499,
						"y": 441.1460554371002
					},
					{
						"x": 26,
						"y": 441
					},
					{
						"x": 26,
						"y": 445
					},
					{
						"x": 26,
						"y": 446
					},
					{
						"x": 26,
						"y": 444
					},
					{
						"x": 26,
						"y": 446
					},
					{
						"x": 27,
						"y": 450
					},
					{
						"x": 25,
						"y": 451
					},
					{
						"x": 25.223076923076924,
						"y": 453.03846153846155
					}
				]
			},
			"angle": 0.04995839572194276
		},
		{
			"site": {
				"x": 15,
				"y": 457,
				"voronoiId": 548
			},
			"edge": {
				"lSite": {
					"x": 44,
					"y": 435,
					"voronoiId": 520
				},
				"rSite": {
					"x": 15,
					"y": 457,
					"voronoiId": 548
				},
				"vb": {
					"x": 25.81769722814499,
					"y": 441.1460554371002
				},
				"va": {
					"x": 17.952282157676347,
					"y": 430.7780082987552
				},
				"path": [
					{
						"x": 17.952282157676347,
						"y": 430.7780082987552
					},
					{
						"x": 19,
						"y": 434
					},
					{
						"x": 21,
						"y": 435
					},
					{
						"x": 21,
						"y": 435
					},
					{
						"x": 22,
						"y": 441
					},
					{
						"x": 25,
						"y": 441
					},
					{
						"x": 25,
						"y": 440
					},
					{
						"x": 24,
						"y": 442
					},
					{
						"x": 25.81769722814499,
						"y": 441.1460554371002
					}
				]
			},
			"angle": -0.6489955589965009
		},
		{
			"site": {
				"x": 15,
				"y": 457,
				"voronoiId": 548
			},
			"edge": {
				"lSite": {
					"x": 15,
					"y": 457,
					"voronoiId": 548
				},
				"rSite": {
					"x": 1,
					"y": 451,
					"voronoiId": 537
				},
				"vb": {
					"x": 0,
					"y": 472.6666666666667
				},
				"va": {
					"x": 17.952282157676347,
					"y": 430.7780082987552
				},
				"path": [
					{
						"x": 17.952282157676347,
						"y": 430.7780082987552
					},
					{
						"x": 12,
						"y": 433
					},
					{
						"x": 12,
						"y": 443
					},
					{
						"x": 4,
						"y": 451
					},
					{
						"x": 2,
						"y": 461
					},
					{
						"x": 2,
						"y": 468
					},
					{
						"x": 1,
						"y": 471
					},
					{
						"x": 1,
						"y": 473
					},
					{
						"x": 0,
						"y": 472.6666666666667
					}
				]
			},
			"angle": -2.7367008673047097
		},
		{
			"site": {
				"x": 15,
				"y": 457,
				"voronoiId": 548
			},
			"edge": {
				"lSite": {
					"x": 15,
					"y": 457,
					"voronoiId": 548
				},
				"rSite": null,
				"vb": {
					"x": 0,
					"y": 478.6979166666667
				},
				"va": {
					"x": 0,
					"y": 472.6666666666667
				},
				"path": [
					{
						"x": 0,
						"y": 472.6666666666667
					},
					{
						"x": 0,
						"y": 472
					},
					{
						"x": 0,
						"y": 473
					},
					{
						"x": 0,
						"y": 473
					},
					{
						"x": 0,
						"y": 473
					},
					{
						"x": 0,
						"y": 475
					},
					{
						"x": 0,
						"y": 478
					},
					{
						"x": 0,
						"y": 478
					},
					{
						"x": 0,
						"y": 478.6979166666667
					}
				]
			},
			"angle": 3.141592653589793
		}
	]

	this.definePath = function () {
		this.overZero();
		//this.logHEdges();
		var edges = [];
		if (this.cell) {
			for (var i = 0; i < this.cell.halfedges.length; i++) {
				edges.push(this.cell.halfedges[i].edge);
			}

			this.path.push(edges[0].va);
			var i = 0;
			while ( edges.length > 0) {
				//Last inserted point
				var a = this.path[this.path.length-1];
				//Vertex to process
				var v = edges[i%edges.length];
				var va = edges[i%edges.length].va;
				var vb = edges[i%edges.length].vb;
				//console.log(Math.floor(va.x)+':'+Math.floor(va.y)+' '+Math.floor(vb.x)+':'+Math.floor(vb.y));
				var msg = '';
				//The paths can be A - B or B - A, there is no way of knowing beforehand, we need to check for that, and not put twice the same point
				if ( (a.x == va.x) && (a.y == va.y) ) {
					edges.splice(edges.indexOf(v), 1);
					this.path = this.path.concat(v.path);
					i = 0;
					msg = 'a == vb ('+Math.floor(10*a.x)/10+':'+Math.floor(10*a.y)/10+')';
				}
				else if ( (a.x == vb.x) && (a.y == vb.y) ) {
					edges.splice(edges.indexOf(v), 1);
					for(var j = (v.path.length-1);j>=0;j--) {
						this.path.push(v.path[j]);
					}
					i = 0;
					msg = 'a == va ('+Math.floor(10*a.x)/10+':'+Math.floor(10*a.y)/10+')';
				}
				else {
					msg = '... ('+Math.floor(10*a.x)/10+':'+Math.floor(10*a.y)/10+')';
					i++;
				}
				//console.log(i+' : '+edges.length+' '+Math.floor(10*va.x)/10+':'+Math.floor(10*va.y)/10+' - '+Math.floor(10*vb.x)/10+':'+Math.floor(10*vb.y)/10+' '+msg)
				if( i >= 50 ) break;

			}
		}
		else {
			console.log("define path error on cell "+this.id)
		}

		//this.logPath();
	}

	this.overZero = function () {
		if (this.cell) {
			for (var i = 0; i < this.cell.halfedges.length; i++) {
				if(this.cell.halfedges[i].edge.va.x<0) this.cell.halfedges[i].edge.va.x = 0;
				if(this.cell.halfedges[i].edge.va.y<0) this.cell.halfedges[i].edge.va.y = 0;
				if(this.cell.halfedges[i].edge.vb.x<0) this.cell.halfedges[i].edge.vb.x = 0;
				if(this.cell.halfedges[i].edge.vb.y<0) this.cell.halfedges[i].edge.vb.y = 0;
			}
		}
		else {
			console.log('error overZero def on cell '+this.id);
		}
	}

	var canvas = document.getElementById('voronoiCanvas');
	var ctx = canvas.getContext('2d');

	ctx.fillStyle = '#2e6689';

	ctx.beginPath();

	ctx.moveTo(path[0].x,path[0].y);
	for (var i = 1; i < path.length; i++) {
		ctx.lineTo(path[i].x,path[i].y);
	}

	for (var i = 0; i < this.halfedges.length; i++){
		 ctx.moveTo(this.halfedges[i].edge.va.x,this.halfedges[i].edge.va.y,1,1 )   
		 ctx.lineTo(this.halfedges[i].edge.vb.x,this.halfedges[i].edge.vb.y,1,1 )  
	}

	this.definePath();
	
	ctx.moveTo(this.path[0].x,this.path[0].y);
	for (var i = 1; i < this.path.length; i++) {
		ctx.lineTo(this.path[i].x,this.path[i].y);
	}
	
	ctx.closePath();
	ctx.fill();

	ctx.strokeStyle = '#666';
	ctx.stroke();
}
var t = new Test();
</script>